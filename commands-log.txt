# سجل أوامر مشروع Andro.Backend.Reference
## التاريخ: 28 يناير 2026

### 1. تحديث ABP CLI
```powershell
dotnet tool update -g Volo.Abp.Studio.Cli
```

### 2. إنشاء المشروع
```powershell
abp new Andro.Backend.Reference -t app --ui none --database-provider ef --database-management-system sqlserver
```
**النتيجة:** ✅ تم إنشاء المشروع بنجاح

### 3. تشغيل DbMigrator لإنشاء قاعدة البيانات
```powershell
cd "src/Andro.Backend.Reference.DbMigrator"
dotnet run
```
**الوصف:** يقوم بإنشاء قاعدة البيانات وتطبيق جميع الـ Migrations وإضافة البيانات الأولية (Admin User)
**النتيجة:** ✅ تم إنشاء قاعدة البيانات بنجاح
- قاعدة البيانات: `Reference`
- المستخدم الافتراضي: `admin / 1q2w3E*`

### 4. تشغيل المشروع (Web Application)
```powershell
cd "src/Andro.Backend.Reference.Web"
dotnet run
```
**الوصف:** يقوم بتشغيل التطبيق على HTTPS
**النتيجة:** ✅ المشروع يعمل بنجاح
- الرابط الرئيسي: `https://localhost:44309`
- Swagger UI: `https://localhost:44309/swagger`
- Health Check: `https://localhost:44309/health-status`

### 5. إنشاء Postman Collection
**الملفات المُنشأة:**
- `Andro.Backend.Reference.postman_collection.json` - Collection كامل لكل APIs
- `Andro.Backend.Reference.postman_environment.json` - Environment للمتغيرات
- `postman-guide.md` - دليل شامل للاستخدام

**المحتويات:**
- Authentication APIs (Login, Logout, Register)
- User Profile APIs
- Application Configuration
- Identity Management (Users & Roles)
- Tenant Management
- Health Check
- مكان جاهز لـ Products APIs (سيتم إضافتها في المرحلة 2)

**الاستخدام:**
1. استورد الملفين في Postman
2. فعل Environment
3. سجل دخول → Token يحفظ تلقائياً
4. اختبر أي API

**النتيجة:** ✅ Postman Collection جاهز للاستخدام

### 6. تصحيح وإعادة بناء المشروع
```powershell
# إيقاف المشروع القديم
taskkill /F /PID 34988

# تنظيف المشروع
dotnet clean

# بناء المشروع
dotnet build

# تشغيل المشروع
cd "src/Andro.Backend.Reference.Web"
dotnet run
```
**النتيجة:** ✅ المشروع يعمل بدون مشاكل

### 7. تصحيح Login في Postman Collection
**المشكلة:** `/api/account/login` لا يرجع `access_token`

**الحل:** استخدام OAuth2 Token endpoint الصحيح
- Endpoint: `/connect/token`
- Method: POST (x-www-form-urlencoded)
- Parameters:
  - grant_type: password
  - client_id: Reference_App
  - username: admin
  - password: 1q2w3E*
  - scope: offline_access Reference

**النتيجة:** ✅ يرجع JWT Token صحيح

### 8. إنشاء Product Entity (المرحلة 2)

**الخطوات:**

#### 1. إنشاء Product Entity في Domain
```
ملف: src/Andro.Backend.Reference.Domain/Products/Product.cs
```
- Entity يرث من `FullAuditedAggregateRoot<Guid>`
- Properties: Name, Price, Stock, Description

#### 2. إضافة DbSet وConfiguration في DbContext
```
ملف: src/Andro.Backend.Reference.EntityFrameworkCore/EntityFrameworkCore/ReferenceDbContext.cs
```
- إضافة `DbSet<Product> Products`
- Configuration للـ Table وال Columns

#### 3. إنشاء Migration
```powershell
dotnet ef migrations add "Added_Product_Entity" --project src/Andro.Backend.Reference.EntityFrameworkCore/Andro.Backend.Reference.EntityFrameworkCore.csproj --startup-project src/Andro.Backend.Reference.DbMigrator/Andro.Backend.Reference.DbMigrator.csproj
```
**النتيجة:** ✅ Migration created

#### 4. تطبيق Migration
```powershell
cd "src/Andro.Backend.Reference.DbMigrator"
dotnet run
```
**النتيجة:** ✅ جدول AppProducts تم إنشاؤه في قاعدة البيانات

#### 5. إنشاء DTOs في Application.Contracts
```
- ProductDto.cs
- CreateProductDto.cs
- UpdateProductDto.cs
- IProductAppService.cs
```

#### 6. إنشاء ProductAppService في Application
```
ملف: src/Andro.Backend.Reference.Application/Products/ProductAppService.cs
```
- يطبق IProductAppService
- CRUD operations كاملة مع manual mapping

#### 7. بناء المشروع
```powershell
dotnet build
```
**النتيجة:** ✅ Build succeeded

#### 8. تشغيل المشروع
```powershell
cd "src/Andro.Backend.Reference.Web"
dotnet run
```
**النتيجة:** ✅ المشروع يعمل مع Product APIs

### 9. تحديث Postman Collection
**تم إضافة:**
- Get Products List (مع Pagination & Sorting)
- Get Product By Id
- Create Product (يحفظ product_id تلقائياً)
- Update Product
- Delete Product

**Endpoint:** `/api/app/product`

### 10. إضافة Authorization & Permissions (المرحلة 3)

**الخطوات:**

#### 1. تعريف Permissions
```
ملف: src/Andro.Backend.Reference.Application.Contracts/Permissions/ReferencePermissions.cs
```
- إضافة `Products.Default`, `Create`, `Edit`, `Delete`

#### 2. Permission Definition Provider
```
ملف: src/Andro.Backend.Reference.Application.Contracts/Permissions/ReferencePermissionDefinitionProvider.cs
```
- تسجيل Product Permissions
- إضافة Parent-Child Hierarchy

#### 3. Localization
```
ملف: src/Andro.Backend.Reference.Domain.Shared/Localization/Reference/en.json
```
- إضافة نصوص الـ Permissions

#### 4. تطبيق Authorization
```
ملف: src/Andro.Backend.Reference.Application/Products/ProductAppService.cs
```
- إضافة `[Authorize]` attributes على كل method
- `GetList/Get` → `Products.Default`
- `Create` → `Products.Create`
- `Update` → `Products.Edit`
- `Delete` → `Products.Delete`

#### 5. Data Seeding للـ Permissions
```
ملف: src/Andro.Backend.Reference.DbMigrator/ProductPermissionsDataSeedContributor.cs
```
- إعطاء Admin Role كل Product Permissions تلقائياً

#### 6. تطبيق Permissions
```powershell
cd "src/Andro.Backend.Reference.DbMigrator"
dotnet run
```
**النتيجة:** ✅ Admin Role عنده الآن كل Product Permissions

#### 7. بناء وتشغيل المشروع
```powershell
dotnet build
cd "src/Andro.Backend.Reference.Web"
dotnet run
```
**النتيجة:** ✅ APIs محمية بـ Permissions

---
